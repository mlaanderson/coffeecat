<!DOCTYPE html>

<html>
    <head>
        <title>CoffeeCat</title>
        <link href='//fonts.googleapis.com/css?family=Old+Standard+TT:400,400italic,700' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:400,700,600' rel='stylesheet' type='text/css'>
        <link href='style.css' rel='stylesheet' type='text/css'>
    </head>
    <body>
        <div>
            <h1 id="coffeecat">CoffeeCat</h1>
            <p>An Applet Container for NodeJS and Express</p>
            <p><img src="coffeecat.jpg"></p>
            <h4 id="about">About</h4>
            <p>CoffeeCat provides a containerized system under <a href="https://www.expressjs.com">Express</a>. Containers are full Express applications
            which are mounted automatically by the server at start up. CoffeeCat provides the structure for loading apps and associating them
            with paths. It provides a configuration (JSON) based setup for the Express server.</p>
            <h4 id="configuration">Configuration</h4>
            <p>Configuration is done in a JSON file. The default configuration file location is in conf/server.json. An optional path
            can be used by using the -c flag on the command line. An applet is defined by it's container (web path) and it's path (file system path).
            Currently, only HTTP, HTTP/2, and HTTPS protocols, with or without WebSockets, are supported.</p>
            <pre><code>{
    "autoLoadApplets": "./applets",
    "applets": [],
    "protocols": [
        {
            "name": "http",
            "port": 8080,
            "listen": "0.0.0.0",
            "websockets": true
        }, {
            "name": "https",
            "port": 8443,
            "listen": "0.0.0.0",
            "ssl": true,
            "cert": "./encryption/coffeecat.crt",
            "key": "./encryption/coffeecat.key"
        }
    ],
    "errorTemplate": "./conf/errors.ejs"
}</code></pre>
            <h5 id="autoloadapplets">autoLoadApplets</h5>
            <p>Specifies a file system location from which to automatically add applets to the applets array. Applets are sub directories
            of this location and are loaded by directory name. That is if there is a directory called <code>hello</code>, the applet there will be mounted at
            <code>/hello</code>. The only exception to this is a directory called <code>ROOT</code> which will be mounted at the webserver root.</p>
            <h5 id="applets">applets</h5>
            <p>An array of applet definitions. </p>
            <dl>
                <dt>container</dt>
                <dd>The web root of the applet,</dd>
                <dt>path</dt>
                <dd>The file system path to the applet.</dd>
            </dl>
            <h5 id="protocols">protocols</h5>
            <p>Currently supports http and https. Defines the ports to listen on, whether it is encrypted, and whether WebSockets are enabled.</p>
            <dl>
                <dt>name</dt>
                <dd>The name of the protocol, e.g. "http" or "https"</dd>
                <dt>port</dt>
                <dd>The numeric port for the protocol to listen on.</dd>
                <dt>listen</dt>
                <dd>A string of the interface address to listen on, or a boolean. False turns off the protocol, True is the same as "0.0.0.0", but not the same as the IPv6 equivalent "::".</dd>
                <dt>ssl</dt>
                <dd>Indicates whether an SSL certificate should be associated with this protocol.</dd>
                <dt>cert</dt>
                <dd>The SSL certificate location relative to the root directory of the coffeecat installation.</dd>
                <dt>key</dt>
                <dd>The SSL private key location relative to the root directory of the coffeecat installation.</dd>
                <dt>websockets</dt>
                <dd>Indicates whether to attach a WebSockets server on top of this protocol</dd>
            </dl>
            <h4 id="websockets">WebSockets</h4>
            <p>If a protocol supports WebSockets, then a WebSocket server will be started on top of that protocol. WebSocket clients are directed according to the request URI. If there is an applet mounted at /test, then WebSocket clients need to be created for the /test path. A future enhancement might parse the request path to see which applet it needs to be routed to.</p>
            <h4 id="ipv6">IPv6</h4>
            <p>To listen on IPv6 addresses along with IPv4 addresses, just duplicate the protocol settings and include an IPv6 address.</p>
            <pre><code>{
    "autoLoadApplets": "./applets",
    "applets": [],
    "protocols": [
        {
            "name": "http",
            "port": 8080,
            "listen": "0.0.0.0",
            "websockets": true
        }, {
            "name": "http",
            "port": 8080,
            "listen": "::",
            "websockets": true
        }
    ],
    "errorTemplate": "./conf/errors.ejs"
}</code></pre>
            <h4 id="http2">HTTP/2</h4>
            <p>HTTP/2 is only supported with modern browsers and only with TLS. For Edge and Internet Exlporer, HTTP/2 is only supported in Windows 10 and higher. For Safari, HTTP/2 
            is only supported in Mac OS X 10.11 and higher. For further compatibility see the <a href="https://caniuse.com/#feat=http2">CanIUse page.</a></p>
            <p>The built-in http2 module for NodeJS does not work as seamlessly with Express as the <a href="https://github.com/spdy-http2/node-spdy">spdy</a> library. So install
            the spdy library:</p>
            <pre><code>npm install -s git+https://github.com/spdy-http2/node-spdy.git</code></pre>
            <p>Configure the SPDY protocol with SSL, identical to an HTTPS configuration:</p>
            <pre><code>{
    "name": "spdy",
    "port": 8443,
    "listen": "0.0.0.0",
    "ssl": true,
    "cert": "./encryption/coffeecat.crt",
    "key": "./encryption/coffeecat.key"
}</code></pre>
            <p>In the applet, use the extended features of the HTTP/2 protocol to stream additional resources:</p>
            <pre><code>router.get('/', (req, res, next) =&gt; {
    var stream = res.push('/main.js', {
        status: 200,
        method: 'GET',
        request: {
            accept: '*/*'
        },
        response: {
            'content-type': 'application/javascript'
        }
    });
    stream.end('alert("Hello from SPDY aka HTTP/2");');
    res.render('index',{}); 
});</code></pre>
            <p>Where the index template includes <code>&lt;script src="main.js"&gt;&lt;/script&gt;</code></p></div>
    </body>
</html>